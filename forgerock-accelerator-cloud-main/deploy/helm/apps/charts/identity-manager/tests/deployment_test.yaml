suite: identity-manager deployment tests 
templates:
  - ../templates/deploy.yaml
tests:
  - it: Check deploy.yaml values
    values:
      - ../values.yaml
      - ../../../values.yaml

    asserts:
      - isKind:
          of: StatefulSet
      - isAPIVersion:
          of: apps/v1 
      - equal:
          path: metadata.name
          value: forgerock-idm-dc1
      - matchRegex:
          path: metadata.namespace
          pattern: ^forgerock.*
      - equal:
          path: spec.podManagementPolicy
          value: Parallel
      - equal:
          path: spec.selector.matchLabels.app
          value: forgerock-idm-dc1
      - exists:
          path: spec.replicas
      - equal:
          path: spec.serviceName
          value: forgerock-idm
      - equal:
          path: spec.template.metadata.labels.app
          value: forgerock-idm-dc1
      - equal:
          path: spec.template.spec.securityContext.runAsUser
          value: 10002
      - equal:
          path: spec.template.spec.securityContext.runAsGroup
          value: 10002
      - equal:
          path: spec.template.spec.securityContext.fsGroup
          value: 10002
      - equal:
          path: spec.template.spec.containers[0].name
          value: idm
      - exists:
          path: spec.template.spec.containers[0].image
      - equal:
          path: spec.template.spec.containers[0].imagePullPolicy
          value: Always
      - equal:
          path: spec.template.spec.containers[0].securityContext.allowPrivilegeEscalation
          value: false
      - equal:
          path: spec.template.spec.containers[0].securityContext.privileged
          value: false
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.httpHeaders[0].name
          value: X-OpenIDM-Username
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.httpHeaders[0].value
          value: anonymous
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.httpHeaders[1].name
          value: X-OpenIDM-Password
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.httpHeaders[1].value
          value: anonymous
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.httpHeaders[2].name
          value: Accept-API-Version
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.httpHeaders[2].value
          value: resource=1.0
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.httpHeaders[3].name
          value: X-OpenIDM-NoSession
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.httpHeaders[3].value
          value: "true"
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.path
          value: /openidm/info/ping
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.port
          value: 8443
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.scheme
          value: HTTPS
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.initialDelaySeconds
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.successThreshold
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.failureThreshold
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.periodSeconds
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.timeoutSeconds
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.httpHeaders[0].name
          value: X-OpenIDM-Username
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.httpHeaders[0].value
          value: anonymous
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.httpHeaders[1].name
          value: X-OpenIDM-Password
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.httpHeaders[1].value
          value: anonymous
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.httpHeaders[2].name
          value: Accept-API-Version
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.httpHeaders[2].value
          value: resource=1.0
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.httpHeaders[3].name
          value: X-OpenIDM-NoSession
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.httpHeaders[3].value
          value: "true"
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.path
          value: /openidm/info/ping
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.port
          value: 8443
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.scheme
          value: HTTPS
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.initialDelaySeconds
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.successThreshold
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.failureThreshold
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.periodSeconds
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.timeoutSeconds
      - exists:
          path: spec.template.spec.containers[0].resources.requests.cpu
      - exists:
          path: spec.template.spec.containers[0].resources.requests.memory
      - exists:
          path: spec.template.spec.containers[0].resources.limits.cpu
      - exists:
          path: spec.template.spec.containers[0].resources.limits.memory
      - exists:
          path: spec.template.spec.containers[0].envFrom[0].secretRef.name
      - equal:
          path: spec.template.spec.containers[0].envFrom[1].configMapRef.name
          value: forgerock-idm-dc1
      - equal:
          path: spec.template.spec.containers[0].env[0].name
          value: SECRET_CERTIFICATE_US
      - equal:
          path: spec.template.spec.containers[0].env[0].valueFrom.secretKeyRef.name
          value: forgerock-user-store-dc1
      - equal:
          path: spec.template.spec.containers[0].env[0].valueFrom.secretKeyRef.key
          value: SECRET_CERTIFICATE
      - equal:
          path: spec.template.spec.containers[0].ports[0].name
          value: http
      - equal:
          path: spec.template.spec.containers[0].ports[0].containerPort
          value: 8080
      - equal:
          path: spec.template.spec.containers[0].ports[0].protocol
          value: TCP
      - equal:
          path: spec.template.spec.containers[0].ports[1].name
          value: https
      - equal:
          path: spec.template.spec.containers[0].ports[1].containerPort
          value: 8443
      - equal:
          path: spec.template.spec.containers[0].ports[1].protocol
          value: TCP
      - equal:
          path: spec.template.spec.imagePullSecrets[0].name
          value: fr-nexus-docker