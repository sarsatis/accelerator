suite: identity-gateway deployment tests 
templates:
  - ../templates/deploy.yaml
tests:
  - it: Check deploy.yaml values
    values:
      - ../values.yaml
      - ../../../values.yaml

    asserts:
      - isKind:
          of: StatefulSet
      - isAPIVersion:
          of: apps/v1 
      - equal:
          path: metadata.name
          value: forgerock-ig-dc1
      - matchRegex:
          path: metadata.namespace
          pattern: ^forgerock.*
      - equal:
          path: metadata.labels.app
          value: forgerock-ig-dc1
      - equal:
          path: spec.podManagementPolicy
          value: Parallel
      - equal:
          path: spec.serviceName
          value: forgerock-ig
      - equal:
          path: spec.replicas
          value: 1
      - equal:
          path: spec.selector.matchLabels.app
          value: forgerock-ig-dc1
      - equal:
          path: spec.template.metadata.labels.app
          value: forgerock-ig-dc1
      - equal:
          path: spec.template.spec.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].weight
          value: 1
      - equal:
          path: spec.template.spec.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].podAffinityTerm.labelSelector.matchExpressions[0].key
          value: app
      - equal:
          path: spec.template.spec.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].podAffinityTerm.labelSelector.matchExpressions[0].operator
          value: In
      - equal:
          path: spec.template.spec.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].podAffinityTerm.labelSelector.matchExpressions[0].values[0]
          value: forgerock-ig-dc1
      - equal:
          path: spec.template.spec.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].podAffinityTerm.topologyKey
          value: kubernetes.io/hostname
      - equal:
          path: spec.template.spec.securityContext.runAsUser
          value: 10002
      - equal:
          path: spec.template.spec.securityContext.runAsGroup
          value: 10002
      - equal:
          path: spec.template.spec.securityContext.fsGroup
          value: 10002
      - equal:
          path: spec.template.spec.hostAliases[0].ip
          value: 127.0.0.1
      - equal:
          path: spec.template.spec.hostAliases[0].hostnames[0]
          value: igdc1.midships.io
      - equal:
          path: spec.template.spec.containers[0].name
          value: forgerock-ig-dc1
      - equal:
          path: spec.template.spec.containers[0].image
          value: gcr.io/massive-dynamo-235117/forgerock-ig:stable
      - equal:
          path: spec.template.spec.containers[0].imagePullPolicy
          value: Always
      - exists:
          path: spec.template.spec.containers[0].resources.requests.cpu
      - exists:
          path: spec.template.spec.containers[0].resources.requests.memory
      - exists:
          path: spec.template.spec.containers[0].resources.limits.cpu
      - exists:
          path: spec.template.spec.containers[0].resources.limits.memory
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.path
          value: /openig/ping
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.port
          value: 8443
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.scheme
          value: HTTPS
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.initialDelaySeconds
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.successThreshold
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.failureThreshold
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.periodSeconds
      - exists:
          path: spec.template.spec.containers[0].livenessProbe.timeoutSeconds
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.path
          value: /openig/ping
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.port
          value: 8443
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.scheme
          value: HTTPS
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.initialDelaySeconds
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.periodSeconds
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.successThreshold
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.failureThreshold
      - exists:
          path: spec.template.spec.containers[0].readinessProbe.timeoutSeconds
      - equal:
          path: spec.template.spec.containers[0].envFrom[0].secretRef.name
          value: forgerock-ig-dc1
      - equal:
          path: spec.template.spec.containers[0].envFrom[1].configMapRef.name
          value: forgerock-ig-dc1
      - equal:
          path: spec.template.spec.containers[0].ports[0].name
          value: http
      - equal:
          path: spec.template.spec.containers[0].ports[0].containerPort
          value: 8080
      - equal:
          path: spec.template.spec.containers[0].ports[0].protocol
          value: TCP
      - equal:
          path: spec.template.spec.containers[0].ports[1].name
          value: https
      - equal:
          path: spec.template.spec.containers[0].ports[1].containerPort
          value: 8443
      - equal:
          path: spec.template.spec.containers[0].ports[1].protocol
          value: TCP
      - equal:
          path: spec.template.spec.imagePullSecrets[0].name
          value: fr-nexus-docker
              